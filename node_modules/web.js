var toJSON = function(request, callback) {
	var res = '';

	request.on('data', function (chunk){
		res += chunk;
	});

	request.on('end',function() {
		try {
			res = JSON.parse(res);
		} catch(err) {
			callback(err);
			return;
		}
		callback(null, res);
	});
};
exports.toJSON = toJSON;

var post = function(url,data,callback) {
	
	var body = JSON.stringify(data);
	var uri = parse(url);
	
	callback = callback || noop;
    
	var options = {
	  host: uri.hostname,
	  port: url.port,	  
	  path: uri.pathname,
	  method: 'POST',
	  headers: {
		'Content-Length': body.length
		}
	};

	common.step([
		function(next) {
			var request =  http.request(options, function(response){
				streams.toJSON(response, next);
			});
			request.write(body);
			request.end();					
		}, function(d) {
			callback(null,d);
		}], callback
	);
};
exports.post = post;