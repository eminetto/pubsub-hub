(function(g){(function(){if(typeof g==="undefined"){var h=function(){},d={},f={};g=function(a){if(arguments.length>1){for(var b=g(arguments[0]),c=1;c<arguments.length;c++)g(arguments[c]);return b}a=a.split("@")[0];if(f[a]&&!d[a]){b=f[a];delete f[a];var e=d[a]=function(){return e.exports};e.browser=!0;e.exports={};b(e,e.exports)}return window[a]||(d[a]||h)()};g.define=function(a,b){f[a]=b}}})();g.define("pubsub.io",function(h,d){var f=g("json-sockets"),a=g("common"),b=function(){};d.connect=function(){var c=
f.connect.apply(f,arguments),e={},l={};c.on("message",function(c){c.name==="publish"&&(l[c.id]||b)(c.doc)});e.subscribe=function(b,e,d){d||(d=e,e=void 0);var f=a.gensym();l[f]=d;c.send({name:"subscribe",id:f,query:b,selection:e});return function(){c.send({name:"unsubscribe",id:f})}};e.publish=function(b){c.send({name:"publish",doc:b})};return e}});g.define("json-sockets",function(h,d){var f=g("common").emitter(function(a){this._ws=a=new WebSocket("ws://"+a+"/json-socket");this._buffer=[];var b=this;
a.onopen=function(){for(;b._buffer.length;)b._send(b._buffer.shift());b.send=b._send;b.emit("open")};a.onmessage=function(c){b.emit("message",JSON.parse(c.data))};a.onclose=function(){b.emit("close")}});f.prototype.send=function(a){this._buffer.push(a)};f.prototype._send=function(a){this._ws.send(JSON.stringify(a))};d.connect=function(a){a=a||window.location.host;return new f(a)}});g.define("common",function(h,d){var f=function(){},a;h.browser?(a=function(){this._events={}},a.prototype.on=a.prototype.addListener=
function(b,c){this.emit("newListener",b,c);(this._events[b]=this._events[b]||[]).push(c)},a.prototype.once=function(b,c){var e=this,a=function(){e.removeListener(b,c);c.apply(this,arguments)};a.listener=c;this.on(b,a)},a.prototype.emit=function(b){var c=this._events[b];if(c)for(var e=Array.prototype.slice.call(arguments,1),c=c.slice(),a=0;a<c.length;a++)c[a].apply(null,e)},a.prototype.removeListener=function(b,c){var e=this._events[b];if(e){for(var a=0;a<e.length;a++)if(e[a]===c||e[a].listener===
c){e.splice(a,1);break}e.length||delete this._events[b]}},a.prototype.removeAllListeners=function(b){arguments.length?delete this._events[b]:this._events={}},a.prototype.listeners=function(b){return this._events[b]||[]}):a=g("events").EventEmitter;Object.create=Object.create||function(b){var c=function(){};c.prototype=b;return new c};d.extend=function(b,c){var a=function(){b.call(this);c.apply(this,arguments)};a.prototype=Object.create(b.prototype);return a};d.createEmitter=function(){return new a};
d.emitter=function(b){return d.extend(a,b)};d.fork=function(b,c){return function(a,d){a?b(a):c(d)}};d.step=function(b,c){var a=0,d=0,m=0,g=!1,h={},k=null,j=!1,i=function(n,o){if(n&&!g)g=!0,(c||f).apply(h,[n]);else if(!(g||a&&!(j&&d>=a))){var p=b[m++],q=p.length===1?[i]:[o,i];a=d=0;k=[];j=!1;p.apply(h,m<b.length?q:[o]);j=!0;a&&j&&d>=a&&i(null,k)}};i.parallel=function(){var b=a++;if(j)throw Error("next.parallel must not be called async");return function(a,c){d++;k[b]=c;i(a,k)}};i()};d.memoizer=function(b){var a=
{},d=function(b){var a=typeof b;if(a!=="object")return a+": "+b;var a=[],c;for(c in b)a.push(d(b[c]));return a.sort().join("\n")};return function(){for(var f="",g=0;g<arguments.length;g++)f+=d(arguments[g])+"\n";a[f]=a[f]||b.apply(null,arguments);return a[f]}};d.curry=function(b){var a=Array.prototype.slice.call(arguments,1);return function(){return b.apply(this,a.concat(Array.prototype.slice.call(arguments)))}};d.once=function(a){var c=!0;return function(){if(c)return c=!1,(a||f).apply(null,arguments),
!0;return!1}};d.future=function(){var a={},c=[];a.get=function(a){c.push(a)};a.put=function(d,f){for(a.get=function(a){a(d,f)};c.length;)c.shift()(d,f)};return a};d.encode=function(){return function(a){return a<62?"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(a):d.encode(Math.floor(a/62))+"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(a%62)}}();d.uuid=function(){var a=0;return function(){for(var c="",e=0;e<36;e++)c+=d.encode(Math.floor(Math.random()*
62));return c+"-"+d.encode(a++)}}();d.gensym=function(){var a=0;return function(){return"s"+a++}}();d.format=function(a,c){c=typeof c==="object"?c:Array.prototype.slice.call(arguments,1);return a.replace(/\{([^{}]+)\}/gm,function(a,b){return c[b]===void 0?a:c[b]})};d.log=function(){var a=d.format.apply(d,arguments);(typeof window==="undefined"||window.console)&&console.log(a)}});window["pubsub"]=g("pubsub.io")})();

